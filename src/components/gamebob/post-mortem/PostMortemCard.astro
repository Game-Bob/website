---
import './PostMortemCard.css';
import { Icon } from "astro-icon/components";
import type { PostMortemEntry } from "../../../data/gamebob/post-mortem/entries";

import { useLanguagePath, useTranslations } from "../../../i18n/utils";

interface Props {
    entry: PostMortemEntry;
}

const { lang } = Astro.params;
const l = useLanguagePath(lang as any);
const t = useTranslations(lang as any);
const { entry } = Astro.props as Props;
const imagePath = entry.image ? `/images/gamebob/post-mortem/${entry.image}` : null;

---

<a
    href={l(`/postmortem/${entry.id}/`)}
    class="pm-card"
>
    <div class="pm-card-top-line"></div>

    <div class="pm-image-wrapper">
        {
            imagePath ? (
                <img
                    src={imagePath}
                    alt={t(`postMortem.${entry.id}.title`)}
                    class="pm-image"
                />
            ) : (
                <div class="pm-image-placeholder">
                    <Icon name="mdi:alert-decagram" class="pm-placeholder-icon" />
                </div>
            )
        }

        <div class="pm-id-badge">
            ID: {entry.id}

        </div>

        <div class="pm-date-badge">
            {t(`postMortem.${entry.id}.date`)}

        </div>
    </div>

    <div class="pm-card-content">
        <h2 class="pm-card-title">
            {t(`postMortem.${entry.id}.title`)}
        </h2>

        <div class="pm-card-body">
            <div class="pm-row">
                <Icon name="mdi:close-circle-outline" class="pm-icon-sm" style="color: var(--color-secondary)" />
                <p class="pm-error-text">
                    "{t(`postMortem.${entry.id}.error`)}"
                </p>
            </div>
            <div class="pm-row">
                <Icon
                    name="mdi:check-circle-outline"
                    class="pm-icon-sm"
                    style="color: var(--color-accent)"
                />
                <p class="pm-lesson-text">
                    {t(`postMortem.${entry.id}.lesson`)}

                </p>
            </div>
        </div>

        <div class="pm-card-footer">
            {
                (() => {
                    const tags = t(`postMortem.${entry.id}.tags`);
                    if (Array.isArray(tags)) {
                        return (tags as string[]).slice(0, 3).map((tag: string) => (
                            <span class="pm-tag">
                                #{tag}
                            </span>
                        ));
                    }
                    return null;
                })()
            }
        </div>
    </div>

    <div class="pm-scan-overlay"></div>
</a>
