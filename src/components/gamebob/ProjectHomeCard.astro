---
import './ProjectHomeCard.css';
import { Icon } from "astro-icon/components";
import { useTranslations, getLangFromUrl, useLanguagePath } from "../../i18n/utils";
import StoreButton from "../common/StoreButton.astro";

interface Props {
    project: any;
    index: number;
}

const { project, index } = Astro.props;
const lang = getLangFromUrl(Astro.url);
const t = useTranslations(lang);
const l = useLanguagePath(lang);

const name = t(`apps.${project.slug}.title`);
const homeDescription = t(`apps.${project.slug}.description`);
const image = "media" in project ? project.media.showcase : project.image;

const statusType = project.roadmap?.statusType || project.statusType || "released";
const statusLabel = t(`roadmap.status.${statusType}`);
const color = project.theme?.primary || project.color || "var(--color-primary)";

const links = project.stores || project.links;

const isEven = index % 2 === 0;
const nameParts = name ? (name.includes(":") ? [name.split(":")[0], name.split(":")[1]] : [name, ""]) : ["", ""];

// Route logic: games go to /games/, utilities to /utilities/
const detailUrl = l(project.isGame ? `/games/${project.slug}` : `/utilities/${project.slug}`);

---

<div class="project-card">
    <a href={detailUrl} class="card-link-overlay" aria-label={`View details for ${name}`}></a>
    
    <div class:list={["project-card-content", { "order-right": !isEven }]}>
        <h3 class="project-card-title">
            <span class="title-main">{nameParts[0]}</span>
            {nameParts[1] && <span class="title-sub" style={`color: ${color}`}>{nameParts[1].trim()}</span>}
        </h3>
        <p class="project-card-description">
            {homeDescription}
        </p>

        <div class="project-status-container">
            <div class:list={[
                    "status-badge",
                    statusType,
                    { "pulse": statusType !== "released" },
                ]}
            >
                {statusLabel}
            </div>
        </div>

        <div class="project-links">
            {
                links?.googlePlay ? (
                    <StoreButton store="googlePlay" url={links.googlePlay} />
                ) : (
                    <div class="store-button-placeholder">
                        <StoreButton store="googlePlay" />
                    </div>
                )
            }

            {
                links?.appStore ? (
                    <StoreButton store="appStore" url={links.appStore} />
                ) : (
                    <div class="store-button-placeholder">
                        <StoreButton store="appStore" />
                    </div>
                )
            }
        </div>
    </div>

    <div
        class:list={[
            "image-wrapper",
            { "order-left": isEven },
        ]}
        style={`box-shadow: 0 25px 50px -12px ${color}33`}
    >
        <div class="image-container">
            {
                image ? (
                    <img
                        src={image}
                        alt={`${name} Cover`}
                        class="project-image"
                    />
                ) : (
                    <div class="image-placeholder">
                        {name}
                    </div>
                )
            }
            <div
                class="gradient-overlay"
                style={`background-image: linear-gradient(to bottom right, ${color}33, transparent)`}
            >
            </div>
            <div class="bottom-overlay">
            </div>
        </div>
    </div>
</div>
