---
export const prerender = true;
import MechanicPage from "../../../components/gamebob/mechanics/MechanicPage.astro";
import MechanicCanvas from "../../../components/gamebob/mechanics/MechanicCanvas.astro";
import MechanicInfo from "../../../components/gamebob/mechanics/MechanicInfo.astro";
import { Icon } from "astro-icon/components";

const GITHUB_BASE =
    "https://github.com/Game-Bob/website/tree/main/src/mechanics/magnetic-finger";
const CODE_URL =
    "https://github.com/Game-Bob/website/blob/main/src/mechanics/magnetic-finger/MagneticFingerMechanic.ts";
---

<MechanicPage
    title="Magnetic Finger"
    description="Controla el magnetismo. Atrae o repele partículas metálicas con tu toque."
    githubUrl={GITHUB_BASE}
    codeurl={CODE_URL}

    image="/images/gamebob/mechanics/magnetic-finger.webp"
>
    <Icon slot="icon" name="mdi:magnet" style="color: var(--color-primary)" />

    <MechanicCanvas
        id="game-canvas"
        instruction="Toca para activar el imán"
        subInstruction="Cambia la polaridad para atraer o repeler"
        verticalOnMobile={true}

    />

    <MechanicInfo>
        <Fragment slot="how-it-works">
            <li>
                <span style="color: var(--color-primary)">•</span>
                <span>Simulación de fuerzas magnéticas.</span>
            </li>
            <li>
                <span style="color: var(--color-primary)">•</span>
                <span>Partículas con masa y fricción variable.</span>
            </li>
            <li>
                <span style="color: var(--color-primary)">•</span>
                <span>Interacción táctil directa.</span>
            </li>
        </Fragment>

        <Fragment slot="controls">
            <div style="display: flex; gap: var(--space-sm); justify-content: center; width: 100%; grid-column: span 1 / -1;">
                <button
                    id="btn-attract"
                    class="magnetic-btn active-mode"
                    style="background: var(--color-primary); color: var(--text-main);"
                >
                    Atraer
                </button>
                <button
                    id="btn-repel"
                    class="magnetic-btn"
                    style="background: var(--bg-surface); color: var(--text-main);"
                >
                    Repeler
                </button>
            </div>
        </Fragment>
    </MechanicInfo>
</MechanicPage>

<style>
    .magnetic-btn {
        padding: 0.5rem 1rem;
        border-radius: var(--radius-md);
        font-weight: 700;
        transition: background 0.2s;
        border: none;
        cursor: pointer;
    }
    
    .magnetic-btn:hover {
        filter: brightness(1.1);
    }

    .active-mode {
        outline: 2px solid white;
        outline-offset: 2px;
    }

</style>

<script>
    import { MagneticFingerGame } from "../../../mechanics/magnetic-finger/MagneticFingerGame";

    const canvas = document.getElementById("game-canvas") as HTMLCanvasElement;
    const overlay = document.getElementById("game-canvas-overlay");
    const btnAttract = document.getElementById("btn-attract");
    const btnRepel = document.getElementById("btn-repel");

    let game: game | null = null;

    if (canvas && overlay) {
        const rect = canvas.getBoundingClientRect();
        canvas.width = rect.width;
        canvas.height = rect.height;

        overlay.addEventListener("click", () => {
            overlay.style.opacity = "0";
            overlay.style.pointerEvents = "none";
            if (!game) {
                game = new MagneticFingerGame(canvas);
            }
        });

        window.addEventListener("resize", () => {
            if (game) game.resize();
        });

        
        
        
        if (btnAttract && btnRepel) {
            btnAttract.addEventListener("click", () => {
                if (game) game.setPolarity(1);

                btnAttract.classList.add("active-mode");
                btnAttract.style.background = "var(--color-primary)"; 

                btnRepel.classList.remove("active-mode");
                btnRepel.style.background = "var(--bg-surface)"; 
            });

            btnRepel.addEventListener("click", () => {
                if (game) game.setPolarity(-1);

                btnRepel.classList.add("active-mode");
                btnRepel.style.background = "var(--color-secondary)"; 

                btnAttract.classList.remove("active-mode");
                btnAttract.style.background = "var(--bg-surface)"; 
            });
        }
    }
</script>
